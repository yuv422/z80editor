/*
 * generated by Xtext
 */
package org.efry.z80editor.validation

import org.eclipse.xtext.validation.Check
import org.efry.z80editor.z80.SignedByteOffset
import org.efry.z80editor.z80.Z80Package
import org.efry.z80editor.z80.BitType
import org.efry.z80editor.z80.AsciiChar

/**
 * This class contains custom validation rules. 
 *
 * See https://www.eclipse.org/Xtext/documentation/303_runtime_concepts.html#validation
 */
class Z80Validator extends AbstractZ80Validator {

	@Check
	def checkOffsetRange(SignedByteOffset offset) {
		var value = offset.value.i; //FIXME need to validate binary and hex numbers too.
		if ("-".equals(offset.sign)) {
			value = -value;
		}
		if (value < -128 || value > 127) {
			error('Signed offset must be in the range (-128 to +127)', Z80Package.Literals.SIGNED_BYTE_OFFSET__VALUE)
		}
	}
	
	@Check
	def checkBitType(BitType type) {
		if (type.value > 7) {
			error('Bit type must be in the range (0 to 7)', Z80Package.Literals.BIT_TYPE__VALUE);
		}
	}
	
	@Check
	def checkAsciiChar(AsciiChar asciiChar) {
	    var charString = asciiChar.char;
	    if (charString != null && charString.length > 1) {
	        error('Single ascii character required', Z80Package.Literals.ASCII_CHAR__CHAR);
	    }
	}
	
	//FIXME check for macro numeric arg. It must be inside a macro block.
}
